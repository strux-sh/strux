strux_version: ${version}
bsp:
  name: qemu
  description: "QEMU virtual machine for testing"
  display:
    resolution: 1920x1080
  
  arch: ${hostArch}
  hostname: ${projectName}

  # =========================================================================
  # SCRIPTS - Custom build scripts that run at specific lifecycle stages
  # =========================================================================
  # 
  # Each script can specify:
  #   - location: Path to the script (relative to this BSP directory)
  #   - step: Which build stage to run at (see options below)
  #   - description: (optional) Human-readable name for logging
  #   - cached_generated_artifacts: (optional) Files generated by script (relative to dist/)
  #                                 If all exist and --clean is not set, script is skipped
  #   - depends_on: (optional) Files this script depends on
  #                 - Paths starting with "./" are relative to the BSP directory
  #                 - Other paths are relative to dist/ (e.g., "cache/rootfs-post.tar.gz")
  #                 If any dependency hash changes, the script re-runs
  #
  # Available steps (in execution order):
  #   BUILD LIFECYCLE:
  #     - before_build      First step, before any compilation
  #     - after_build       Last step, after everything completes
  #
  #   FRONTEND:
  #     - before_frontend   Before Vue/React/vanilla JS compilation
  #     - after_frontend    After frontend compilation
  #
  #   APPLICATION:
  #     - before_application Before main.go compilation
  #     - after_application  After main.go compilation
  #
  #   CAGE COMPOSITOR:
  #     - before_cage       Before Cage Wayland compositor compilation
  #     - after_cage        After Cage compilation
  #
  #   WPE WEBKIT:
  #     - before_wpe        Before WPE extension compilation
  #     - after_wpe         After WPE extension compilation
  #
  #   STRUX CLIENT:
  #     - before_client     Before strux-client binary compilation
  #     - after_client      After strux-client compilation
  #
  #   KERNEL (only runs if boot.kernel.custom_kernel: true):
  #     - before_kernel     Before custom kernel compilation
  #     - after_kernel      After kernel compilation
  #
  #   BOOTLOADER (only runs if boot.bootloader.enabled: true):
  #     - before_bootloader Before bootloader (U-Boot/GRUB) compilation
  #     - after_bootloader  After bootloader compilation
  #
  #   ROOTFS:
  #     - before_rootfs     Before root filesystem creation
  #     - after_rootfs      After root filesystem creation
  #
  #   FINAL IMAGE:
  #     - before_bundle     After post-processing, before make_image
  #     - make_image        Creates the final disk image for target device
  #
  #   FLASHING (handled separately by `strux flash` command):
  #     - flash_script      Script for flashing to device (not run during build)
  #
  # Environment variables available to scripts:
  #   - BSP_NAME                      Name of the BSP
  #   - PROJECT_FOLDER                Project root directory
  #   - PROJECT_DIST_FOLDER           dist/ directory
  #   - PROJECT_DIST_CACHE_FOLDER     BSP-specific cache: dist/cache/{bsp}/ directory
  #   - PROJECT_DIST_OUTPUT_FOLDER    BSP-specific output: dist/output/{bsp}/ directory
  #   - PROJECT_DIST_ARTIFACTS_FOLDER dist/artifacts/ directory (shared)
  #   - SHARED_CACHE_DIR              Shared cache: dist/cache/ (for cross-BSP artifacts)
  #   - BSP_CACHE_DIR                 Alias for PROJECT_DIST_CACHE_FOLDER
  #   - HOST_ARCH                     Host machine architecture
  #   - TARGET_ARCH                   Target device architecture
  #   - STEP                          Current build step name
  #   - STRUX_VERSION                 Strux version
  #
  # Path resolution for depends_on and cached_generated_artifacts:
  #   - "cache/xxx" resolves to dist/cache/{bsp}/xxx (BSP-specific)
  #   - "output/xxx" resolves to dist/output/{bsp}/xxx (BSP-specific)
  #   - "./xxx" resolves to bsp/{bsp}/xxx (relative to BSP directory)
  #   - Other paths are relative to dist/
  # =========================================================================

  scripts:
    # Make image script - creates the final bootable image
    - location: ./scripts/make-image.sh
      step: make_image
      description: "Create QEMU disk image"
      cached_generated_artifacts:
        - output/rootfs.ext4
      depends_on:
        - cache/rootfs-base.tar.gz
        - cache/rootfs-post.tar.gz

    # --- Example: Additional script configurations ---
    #
    # - location: ./scripts/pre-build-setup.sh
    #   step: before_build
    #   description: "Pre-build environment setup"
    #
    # - location: ./scripts/custom-kernel-config.sh
    #   step: before_kernel
    #   description: "Apply custom kernel configurations"
    #   cached_generated_artifacts:
    #     - cache/kernel-config.applied
    #   depends_on:
    #     - bsp/qemu/configs/kernel.config    # Re-run if this config changes
    #
    # - location: ./scripts/post-rootfs-customization.sh
    #   step: after_rootfs
    #   description: "Custom rootfs modifications"
    #   cached_generated_artifacts:
    #     - cache/rootfs-customized.marker
    #   depends_on:
    #     - bsp/qemu/overlay/                 # Re-run if overlay files change
    #     - strux.yaml                        # Re-run if main config changes
    #
    # - location: ./scripts/flash-to-sd.sh
    #   step: flash_script
    #   description: "Flash image to SD card"




  boot:
    # The Bootloader configuration
    bootloader:

      # --- Whether to use a bootloader (Defaults to False) (Set to true if using a custom bootloader such as U-Boot or GRUB) ---
      enabled: false
      
      # --- Bootloader Type (QEMU by default does not use a bootloader, can be grub or u-boot) ---
      # type: u-boot 

      # --- Bootloader Version to download ---
      # version: 2025.10 

      # --- Bootloader Source to download (Can be a valid Git Repository or URL) ---
      # source: https://github.com/u-boot/u-boot/releases/download/v2025.10/u-boot-2025.10.tar.gz

      # --- Bootloader Defconfig to use ---
      # defconfig: qemu_arm64_defconfig


      # --- Bootloader Fragments to apply ---
      # fragments:
      #   - "./configs/u-boot-networking.config"  # file path
      #   - |  # multiline string = inline fragment
      #      CONFIG_NET=y
      #      CONFIG_CMD_PING=y

      # --- Patches to apply to the bootloader ---
      # patches:
      #   - "./patches/u-boot-networking.patch"  # file path
    
    # --- The Kernel Configuration ---
    kernel:

      # ===== Anything in here will override the BSP's Kernel Configuration =====

      # --- Whether to use a custom kernel (Defaults to False) (Set to true if using a custom kernel such as Linux or FreeBSD) ---
      custom_kernel: false

      # ---The Kernel Source to download (Can be a valid Git Repository or URL) ---
      # source: https://github.com/torvalds/linux/releases/download/v6.1/linux-6.1.tar.gz

      # --- The Kernel Version to use ---
      # version: 6.1

      # --- The Kernel Defconfig to use ---
      # defconfig: defconfig

      # --- Kernel Fragments to apply ---
      # fragments:
      #   - "./configs/kernel-networking.config"  # file path
      #   - "./configs/kernel-usb.config"         # another file
      #   - |  # inline fragment
      #       CONFIG_USB_SUPPORT=y
      #       CONFIG_USB_XHCI_HCD=y
      #       CONFIG_NETWORK_FILESYSTEMS=y
      

      # --- Kernel Patches to apply ---
      # patches:
      #   - "./patches/kernel-networking.patch"  # file path
      #   - "./patches/kernel-usb.patch"         # another file

      # --- Device Tree Configuration ---
      # device_tree:
      #   # --- Primary DTS file (filename searches in kernel's arch/*/boot/dts/, path treats as external) ---
      #   dts: qemu-arm64.dts  # or "./dts/qemu-arm64-2.dts" for external file

      #   # --- DTS overlays to apply to base device tree ---
      #   overlays:
      #     - "./dts/overlays/add-device.dtso"  # file path

      #   # --- Additional include paths for DTS compilation ---
      #   include_paths:
      #     - "./dts/includes"


  # --- BSP Specific RootFS Configuration ---
  rootfs:

    # --- The BSP Specific RootFS Overlay Folder ---
    overlay: ./overlay

    # --- The RootFS Packages to install (can be a list of packages or locations to .deb files) ---
    packages:
      - curl
      - wget

